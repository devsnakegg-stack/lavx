{"version":3,"sources":["../src/Sock.ts","../src/Rest.ts","../src/NodeMan.ts","../src/Voice.ts","../src/Player.ts","../src/PlayMan.ts","../src/Queue.ts","../src/QMan.ts","../src/SrcMan.ts","../src/EvtMan.ts","../src/Client.ts","../src/Map.ts"],"sourcesContent":["import WebSocket from 'ws';\nimport { Node } from './NodeMan';\n\nexport class Sock {\n  public readonly node: Node;\n  private ws: WebSocket | null = null;\n  private reconnectTimeout: NodeJS.Timeout | null = null;\n  private reconnectAttempts: number = 0;\n\n  constructor(node: Node) {\n    this.node = node;\n  }\n\n  public connect() {\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) return;\n\n    const { host, port, auth, secure } = this.node.options;\n    const protocol = secure ? 'wss' : 'ws';\n    const url = `${protocol}://${host}:${port}/v4/websocket`;\n\n    const userId = this.node.client.discord.user?.id;\n    if (!userId) {\n      // If client is not ready, retry in 5s\n      this.reconnect();\n      return;\n    }\n\n    this.ws = new WebSocket(url, {\n      headers: {\n        Authorization: auth,\n        'User-Id': userId,\n        'Client-Name': 'lavx',\n      },\n    });\n\n    this.ws.on('open', () => this.onOpen());\n    this.ws.on('message', (data) => this.onMessage(data));\n    this.ws.on('close', (code, reason) => this.onClose(code, reason));\n    this.ws.on('error', (err) => this.onError(err));\n  }\n\n  private onOpen() {\n    this.node.connected = true;\n    this.reconnectAttempts = 0;\n    this.node.client.events.emit('nodeConnect', this.node);\n  }\n\n  private onMessage(data: any) {\n    let payload: any;\n    try {\n      payload = JSON.parse(data.toString());\n    } catch (e) {\n      return;\n    }\n\n    this.node.client.events.emit('raw', payload);\n\n    switch (payload.op) {\n      case 'stats':\n        this.node.stats = payload;\n        break;\n      case 'event':\n        this.handlePlayerEvent(payload);\n        break;\n      case 'playerUpdate':\n        this.handlePlayerUpdate(payload);\n        break;\n      case 'ready':\n        this.node.sessionId = payload.sessionId;\n        this.node.client.events.emit('nodeReady', this.node, payload);\n        break;\n    }\n  }\n\n  private handlePlayerEvent(payload: any) {\n    const player = this.node.client.play.get(payload.guildId);\n    if (!player) return;\n\n    switch (payload.type) {\n      case 'TrackStartEvent':\n        this.node.client.events.emit('trackStart', player, payload.track);\n        break;\n      case 'TrackEndEvent':\n        this.node.client.events.emit('trackEnd', player, payload.track, payload.reason);\n        player.onTrackEnd(payload);\n        break;\n      case 'TrackExceptionEvent':\n        this.node.client.events.emit('trackError', player, payload.track, payload.exception);\n        break;\n      case 'TrackStuckEvent':\n        this.node.client.events.emit('trackStuck', player, payload.track, payload.thresholdMs);\n        break;\n      case 'WebSocketClosedEvent':\n        this.node.client.events.emit('playerDisconnect', player, payload.code, payload.reason, payload.byRemote);\n        break;\n    }\n  }\n\n  private handlePlayerUpdate(payload: any) {\n    const player = this.node.client.play.get(payload.guildId);\n    if (player) {\n      player.state = { ...player.state, ...payload.state };\n    }\n  }\n\n  private onClose(code: number, reason: any) {\n    this.node.connected = false;\n    this.node.sessionId = null;\n    this.node.client.events.emit('nodeDisconnect', this.node, code, reason.toString());\n    this.reconnect();\n  }\n\n  private onError(err: any) {\n    this.node.client.events.emit('nodeError', this.node, err);\n  }\n\n  private reconnect() {\n    if (this.reconnectTimeout) clearTimeout(this.reconnectTimeout);\n    this.reconnectAttempts++;\n    this.reconnectTimeout = setTimeout(() => {\n      this.node.client.events.emit('nodeReconnect', this.node);\n      this.connect();\n    }, Math.min(this.reconnectAttempts * 5000, 30000));\n  }\n\n  public send(payload: any) {\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      this.ws.send(JSON.stringify(payload));\n    }\n  }\n\n  public close() {\n    if (this.ws) {\n      this.ws.removeAllListeners();\n      this.ws.close();\n      this.ws = null;\n    }\n  }\n}\n","import { fetch } from 'undici';\nimport { Node } from './NodeMan';\n\nexport class Rest {\n  public readonly node: Node;\n\n  constructor(node: Node) {\n    this.node = node;\n  }\n\n  private get url() {\n    const { host, port, secure } = this.node.options;\n    return `${secure ? 'https' : 'http'}://${host}:${port}/v4`;\n  }\n\n  public async request(method: string, path: string, body?: any) {\n    const res = await fetch(`${this.url}${path}`, {\n      method,\n      headers: {\n        Authorization: this.node.options.auth,\n        'Content-Type': 'application/json',\n      },\n      body: body ? JSON.stringify(body) : undefined,\n    });\n\n    if (res.status >= 400) {\n      const error: any = await res.json().catch(() => null);\n      const message = error?.message || error?.error || JSON.stringify(error) || 'Unknown error';\n      throw new Error(`Lavalink REST error: ${res.status} - ${message}`);\n    }\n\n    if (res.status === 204) return null;\n    return res.json();\n  }\n\n  public async loadTracks(identifier: string) {\n    return this.request('GET', `/loadtracks?identifier=${encodeURIComponent(identifier)}`);\n  }\n\n  public async decodeTrack(track: string) {\n    return this.request('GET', `/decodetrack?track=${track}`);\n  }\n\n  public async decodeTracks(tracks: string[]) {\n    return this.request('POST', `/decodetracks`, tracks);\n  }\n\n  public async getStats() {\n    return this.request('GET', `/stats`);\n  }\n\n  public async getInfo() {\n    return this.request('GET', `/info`);\n  }\n\n  public async updatePlayer(guildId: string, data: any, noReplace: boolean = false) {\n    if (!this.node.sessionId) throw new Error('Node session ID not available');\n    return this.request('PATCH', `/sessions/${this.node.sessionId}/players/${guildId}?noReplace=${noReplace}`, data);\n  }\n}\n","import { Client, NodeOptions } from './Client';\nimport { Sock } from './Sock';\nimport { Rest } from './Rest';\nimport { Player } from './Player';\n\nexport class NodeMan {\n  public readonly client: Client;\n  public readonly nodes: Map<string, Node>;\n\n  constructor(client: Client) {\n    this.client = client;\n    this.nodes = new Map();\n  }\n\n  public add(options: NodeOptions) {\n    const name = options.name || `${options.host}:${options.port}`;\n    const node = new Node(this.client, name, options);\n    this.nodes.set(name, node);\n    node.connect();\n    return node;\n  }\n\n  public get(name: string) {\n    return this.nodes.get(name);\n  }\n\n  public best() {\n    return Array.from(this.nodes.values())\n      .filter((n) => n.connected && n.sessionId)\n      .sort((a, b) => (a.stats?.players || 0) - (b.stats?.players || 0))[0];\n  }\n\n  public destroy(name: string) {\n    const node = this.nodes.get(name);\n    if (node) {\n      node.destroy();\n      this.nodes.delete(name);\n    }\n  }\n\n  public async migrate(fromNode: Node, toNode?: Node) {\n    const targetNode = toNode || this.best();\n    if (!targetNode || targetNode === fromNode) return;\n\n    const players = Array.from(this.client.play.players.values()).filter(p => p.node === fromNode);\n    for (const player of players) {\n      await player.moveToNode(targetNode);\n    }\n  }\n}\n\nexport class Node {\n  public readonly client: Client;\n  public readonly name: string;\n  public readonly options: NodeOptions;\n  public readonly sock: Sock;\n  public readonly rest: Rest;\n  public connected: boolean = false;\n  public sessionId: string | null = null;\n  public stats: any = null;\n\n  constructor(client: Client, name: string, options: NodeOptions) {\n    this.client = client;\n    this.name = name;\n    this.options = options;\n    this.sock = new Sock(this);\n    this.rest = new Rest(this);\n  }\n\n  public connect() {\n    this.sock.connect();\n  }\n\n  public destroy() {\n    this.sock.close();\n  }\n}\n","import { Player } from './Player';\n\nexport class Voice {\n  public readonly player: Player;\n  public sessionId: string | null = null;\n  public token: string | null = null;\n  public endpoint: string | null = null;\n  public channelId: string | null = null;\n\n  constructor(player: Player) {\n    this.player = player;\n  }\n\n  public update(data: any) {\n    if (data.token) {\n      this.token = data.token;\n      this.endpoint = data.endpoint;\n    } else if (data.session_id) {\n      this.sessionId = data.session_id;\n\n      if (data.channel_id !== this.channelId) {\n        const oldChannelId = this.channelId;\n        this.channelId = data.channel_id;\n        this.player.node.client.events.emit('playerMove', this.player, oldChannelId, this.channelId);\n      }\n    }\n\n    if (this.token && this.sessionId && this.endpoint) {\n      this.player.node.rest.updatePlayer(this.player.guildId, {\n        voice: {\n          token: this.token,\n          endpoint: this.endpoint,\n          sessionId: this.sessionId,\n        },\n      });\n    }\n  }\n}\n","import { Node } from './NodeMan';\nimport { Voice } from './Voice';\n\nexport class Player {\n  public node: Node;\n  public readonly guildId: string;\n  public readonly voice: Voice;\n  public playing: boolean = false;\n  public paused: boolean = false;\n  public state: {\n    time: number;\n    position: number;\n    connected: boolean;\n    ping: number;\n  } = {\n    time: 0,\n    position: 0,\n    connected: false,\n    ping: -1,\n  };\n  public volume: number = 100;\n  public filters: any = {};\n\n  constructor(node: Node, guildId: string) {\n    this.node = node;\n    this.guildId = guildId;\n    this.voice = new Voice(this);\n  }\n\n  public async play(options: { track?: string; startTime?: number; endTime?: number; noReplace?: boolean } = {}) {\n    const queue = this.node.client.queue.get(this.guildId);\n    const track = options.track || queue.current?.track;\n    if (!track) throw new Error('No track to play');\n\n    await this.node.rest.updatePlayer(this.guildId, {\n      encodedTrack: track,\n      position: options.startTime,\n      endTime: options.endTime,\n    }, options.noReplace);\n\n    this.playing = true;\n    this.paused = false;\n  }\n\n  public async stop() {\n    await this.node.rest.updatePlayer(this.guildId, { encodedTrack: null });\n    this.playing = false;\n    this.paused = false;\n  }\n\n  public async pause(state: boolean = true) {\n    await this.node.rest.updatePlayer(this.guildId, { paused: state });\n    this.paused = state;\n  }\n\n  public async resume() {\n    await this.pause(false);\n  }\n\n  public async seek(position: number) {\n    await this.node.rest.updatePlayer(this.guildId, { position });\n  }\n\n  public async setVolume(volume: number) {\n    await this.node.rest.updatePlayer(this.guildId, { volume });\n    this.volume = volume;\n  }\n\n  public async setFilters(filters: any) {\n    await this.node.rest.updatePlayer(this.guildId, { filters });\n    this.filters = filters;\n  }\n\n  public async moveToNode(toNode: Node) {\n    if (this.node === toNode) return;\n    const position = this.state.position;\n    this.node = toNode;\n    if (this.playing || this.paused) {\n      await this.play({ startTime: position });\n    }\n  }\n\n  public async moveToChannel(channelId: string, options: { mute?: boolean; deaf?: boolean } = {}) {\n    await this.connect(channelId, options);\n  }\n\n  public async connect(channelId: string, options: { mute?: boolean; deaf?: boolean } = {}) {\n    this.node.client.sendGatewayPayload(this.guildId, {\n      op: 4,\n      d: {\n        guild_id: this.guildId,\n        channel_id: channelId,\n        self_mute: options.mute ?? false,\n        self_deaf: options.deaf ?? false,\n      },\n    });\n  }\n\n  public async disconnect() {\n    this.node.client.sendGatewayPayload(this.guildId, {\n      op: 4,\n      d: {\n        guild_id: this.guildId,\n        channel_id: null,\n        self_mute: false,\n        self_deaf: false,\n      },\n    });\n\n    await this.stop();\n  }\n\n  public async onTrackEnd(payload: any) {\n    this.playing = false;\n    if (payload.reason !== 'replaced' && payload.reason !== 'stopped') {\n      const queue = this.node.client.queue.get(this.guildId);\n      if (queue.next()) {\n        await this.play();\n      } else if (queue.autoplay && queue.previous.length > 0) {\n        await this.handleAutoplay(queue.previous[queue.previous.length - 1]);\n      } else {\n        this.node.client.events.emit('queueEnd', this);\n      }\n    }\n  }\n\n  private async handleAutoplay(lastTrack: any) {\n    const source = lastTrack.info.sourceName;\n    let query = '';\n\n    if (source === 'youtube') {\n      query = `https://www.youtube.com/watch?v=${lastTrack.info.identifier}&list=RD${lastTrack.info.identifier}`;\n    } else if (source === 'spotify') {\n      query = `sprec:${lastTrack.info.identifier}`;\n    } else if (source === 'deezer') {\n      query = `dzrec:${lastTrack.info.identifier}`;\n    } else if (source === 'apple-music') {\n      query = `amrec:${lastTrack.info.identifier}`;\n    } else {\n      const defaultSearch = this.node.client.options.defaultSearchPlatform || 'ytsearch';\n      query = `${defaultSearch}:${lastTrack.info.author} ${lastTrack.info.title} related`;\n    }\n\n    let res = await this.node.client.src.resolve(query);\n\n    // Fallback if specific recommendation fails\n    if ((!res || !res.tracks.length) && query.includes('rec:')) {\n      const defaultSearch = this.node.client.options.defaultSearchPlatform || 'ytsearch';\n      res = await this.node.client.src.resolve(`${defaultSearch}:${lastTrack.info.author} ${lastTrack.info.title} related`);\n    }\n\n    if (res && res.tracks.length > 0) {\n      // Find a track that is not the same as the last one if possible\n      const track = res.tracks.find(t => t.info.identifier !== lastTrack.info.identifier) || res.tracks[0];\n      const queue = this.node.client.queue.get(this.guildId);\n      queue.add(track);\n      await this.play();\n    } else {\n      this.node.client.events.emit('queueEnd', this);\n    }\n  }\n\n  public filterPresets = {\n    bassboost: { equalizer: [{ band: 0, gain: 0.6 }, { band: 1, gain: 0.67 }, { band: 2, gain: 0.67 }, { band: 3, gain: 0 }] },\n    nightcore: { timescale: { speed: 1.1, pitch: 1.2, rate: 1.0 } },\n    vaporwave: { timescale: { speed: 0.85, pitch: 0.8 } },\n    pop: { equalizer: [{ band: 0, gain: 0.65 }, { band: 1, gain: 0.45 }, { band: 2, gain: -0.45 }, { band: 3, gain: -0.65 }, { band: 4, gain: 0.7 }, { band: 5, gain: 0.45 }, { band: 6, gain: 0.45 }, { band: 7, gain: 0.45 }, { band: 8, gain: 0.45 }, { band: 9, gain: 0.45 }, { band: 10, gain: 0.45 }, { band: 11, gain: 0.45 }, { band: 12, gain: 0.45 }, { band: 13, gain: 0.45 }, { band: 14, gain: 0.45 }] },\n    soft: { equalizer: [{ band: 0, gain: 0 }, { band: 1, gain: 0 }, { band: 2, gain: 0 }, { band: 3, gain: 0 }, { band: 4, gain: 0 }, { band: 5, gain: 0 }, { band: 6, gain: 0 }, { band: 7, gain: 0 }, { band: 8, gain: -0.25 }, { band: 9, gain: -0.25 }, { band: 10, gain: -0.25 }, { band: 11, gain: -0.25 }, { band: 12, gain: -0.25 }, { band: 13, gain: -0.25 }, { band: 14, gain: -0.25 }] },\n  };\n\n  public destroy() {\n    this.node.rest.request('DELETE', `/sessions/${this.node.sessionId}/players/${this.guildId}`);\n  }\n}\n","import { Client } from './Client';\nimport { Player } from './Player';\n\nexport interface PlayerOptions {\n  guildId: string;\n  nodeName?: string;\n}\n\nexport class PlayMan {\n  public readonly client: Client;\n  public readonly players: Map<string, Player>;\n\n  constructor(client: Client) {\n    this.client = client;\n    this.players = new Map();\n  }\n\n  public create(options: PlayerOptions) {\n    let player = this.players.get(options.guildId);\n    if (player) return player;\n\n    const node = options.nodeName ? this.client.node.get(options.nodeName) : this.client.node.best();\n    if (!node) throw new Error('No available Lavalink nodes');\n\n    player = new Player(node, options.guildId);\n    this.players.set(options.guildId, player);\n    this.client.events.emit('playerCreate', player);\n    return player;\n  }\n\n  public get(guildId: string) {\n    return this.players.get(guildId);\n  }\n\n  public destroy(guildId: string) {\n    const player = this.players.get(guildId);\n    if (player) {\n      player.destroy();\n      this.players.delete(guildId);\n      this.client.events.emit('playerDestroy', player);\n    }\n  }\n\n  public handleVoiceUpdate(data: any) {\n    const player = this.players.get(data.guild_id);\n    if (player) {\n      player.voice.update(data);\n    }\n  }\n}\n","import { Track } from './Track';\n\nexport enum LoopMode {\n  None = 'none',\n  Track = 'track',\n  Queue = 'queue',\n}\n\nexport class Queue {\n  public tracks: Track[] = [];\n  public current: Track | null = null;\n  public previous: Track[] = [];\n  public loop: LoopMode = LoopMode.None;\n  public autoplay: boolean = false;\n\n  public add(track: Track | Track[]) {\n    if (Array.isArray(track)) {\n      this.tracks.push(...track);\n    } else {\n      this.tracks.push(track);\n    }\n    if (!this.current) {\n      this.current = this.tracks.shift() || null;\n    }\n  }\n\n  public next() {\n    if (this.current) {\n      if (this.loop === LoopMode.Track) {\n        // stay on current\n        return true;\n      }\n      this.previous.push(this.current);\n      // Keep history at a reasonable size\n      if (this.previous.length > 100) this.previous.shift();\n\n      if (this.loop === LoopMode.Queue) {\n        this.tracks.push(this.current);\n      }\n    }\n\n    this.current = this.tracks.shift() || null;\n    return !!this.current;\n  }\n\n  public skip() {\n    return this.next();\n  }\n\n  public shuffle() {\n    for (let i = this.tracks.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [this.tracks[i], this.tracks[j]] = [this.tracks[j], this.tracks[i]];\n    }\n  }\n\n  public clear() {\n    this.tracks = [];\n    this.current = null;\n    this.previous = [];\n  }\n\n  public remove(index: number) {\n    if (index < 0 || index >= this.tracks.length) return null;\n    return this.tracks.splice(index, 1)[0];\n  }\n}\n","import { Client } from './Client';\nimport { Queue } from './Queue';\n\nexport class QMan {\n  public readonly client: Client;\n  public readonly queues: Map<string, Queue>;\n\n  constructor(client: Client) {\n    this.client = client;\n    this.queues = new Map();\n  }\n\n  public get(guildId: string) {\n    let queue = this.queues.get(guildId);\n    if (!queue) {\n      queue = new Queue();\n      this.queues.set(guildId, queue);\n    }\n    return queue;\n  }\n\n  public delete(guildId: string) {\n    this.queues.delete(guildId);\n  }\n}\n","import { Client } from './Client';\nimport { PlatformMap } from './Map';\nimport { Track } from './Track';\n\nexport interface ResolveResult {\n  type: 'track' | 'playlist' | 'search' | 'error';\n  tracks: Track[];\n  playlistName?: string;\n  playlistArtworkUrl?: string;\n}\n\nexport class SrcMan {\n  public readonly client: Client;\n\n  constructor(client: Client) {\n    this.client = client;\n  }\n\n  public async resolve(input: string): Promise<ResolveResult> {\n    const node = this.client.node.best();\n    if (!node) throw new Error('No available nodes');\n\n    let identifier = input;\n\n    if (!this.isUrl(input)) {\n      const defaultSearch = this.client.options.defaultSearchPlatform || 'ytsearch';\n      identifier = `${defaultSearch}:${input}`;\n    }\n\n    let data: any = await node.rest.loadTracks(identifier);\n\n    // Fallback if empty or error (might happen if plugin is missing for a URL)\n    if ((data.loadType === 'empty' || data.loadType === 'error') && this.isUrl(input)) {\n      const defaultSearch = this.client.options.defaultSearchPlatform || 'ytsearch';\n      data = await node.rest.loadTracks(`${defaultSearch}:${input}`);\n    }\n\n    switch (data.loadType) {\n      case 'track':\n        return { type: 'track', tracks: [this.mapTrack(data.data)] };\n      case 'playlist':\n        return {\n          type: 'playlist',\n          tracks: data.data.tracks.map((t: any) => this.mapTrack(t)),\n          playlistName: data.data.info.name,\n          playlistArtworkUrl: data.data.pluginInfo?.artworkUrl || data.data.info?.artworkUrl,\n        };\n      case 'search':\n        return { type: 'search', tracks: data.data.map((t: any) => this.mapTrack(t)) };\n      case 'error':\n        return { type: 'error', tracks: [] };\n      case 'empty':\n        return { type: 'search', tracks: [] };\n      default:\n        return { type: 'error', tracks: [] };\n    }\n  }\n\n  private isUrl(input: string) {\n    try {\n      new URL(input);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  private mapTrack(data: any): Track {\n    // Ensure duration is present in info\n    if (data.info && !data.info.duration && data.info.length) {\n      data.info.duration = data.info.length;\n    }\n\n    // Capture artwork if in pluginInfo but not info\n    if (data.info && !data.info.artworkUrl && data.pluginInfo?.artworkUrl) {\n      data.info.artworkUrl = data.pluginInfo.artworkUrl;\n    }\n\n    // captue artwork from some plugins that put it in a different place\n    if (data.info && !data.info.artworkUrl && data.info.image) {\n        data.info.artworkUrl = data.info.image;\n    }\n    \n    return {\n      track: data.encoded,\n      info: data.info,\n      src: data.info.sourceName,\n    };\n  }\n}\n","import { EventEmitter } from 'events';\nimport { Client } from './Client';\nimport { Node } from './NodeMan';\nimport { Player } from './Player';\nimport { Track } from './Track';\n\nexport interface LavxEvents {\n  nodeConnect: (node: Node) => void;\n  nodeDisconnect: (node: Node, code: number, reason: string) => void;\n  nodeError: (node: Node, error: Error) => void;\n  nodeReconnect: (node: Node) => void;\n  nodeReady: (node: Node, payload: any) => void;\n  playerCreate: (player: Player) => void;\n  playerDestroy: (player: Player) => void;\n  playerMove: (player: Player, oldChannelId: string | null, newChannelId: string | null) => void;\n  playerDisconnect: (player: Player, code: number, reason: string, byRemote: boolean) => void;\n  trackStart: (player: Player, track: string) => void;\n  trackEnd: (player: Player, track: string, reason: string) => void;\n  trackError: (player: Player, track: string, exception: any) => void;\n  trackStuck: (player: Player, track: string, thresholdMs: number) => void;\n  queueEnd: (player: Player) => void;\n  raw: (payload: any) => void;\n}\n\nexport class EvtMan extends EventEmitter {\n  public readonly client: Client;\n\n  constructor(client: Client) {\n    super();\n    this.client = client;\n  }\n\n  public override emit<K extends keyof LavxEvents>(event: K, ...args: Parameters<LavxEvents[K]>): boolean {\n    return super.emit(event, ...args);\n  }\n\n  public override on<K extends keyof LavxEvents>(event: K, listener: LavxEvents[K]): this {\n    return super.on(event, listener);\n  }\n\n  public override once<K extends keyof LavxEvents>(event: K, listener: LavxEvents[K]): this {\n    return super.once(event, listener);\n  }\n}\n","import { Client as DjsClient } from 'discord.js';\nimport { NodeMan } from './NodeMan';\nimport { PlayMan } from './PlayMan';\nimport { QMan } from './QMan';\nimport { SrcMan } from './SrcMan';\nimport { EvtMan } from './EvtMan';\n\nexport interface LavxOptions {\n  nodes: NodeOptions[];\n  send?: (guildId: string, payload: any) => void;\n  defaultSearchPlatform?: string;\n}\n\nexport interface NodeOptions {\n  name?: string;\n  host: string;\n  port: number;\n  auth: string;\n  secure?: boolean;\n}\n\nexport class Client {\n  public readonly discord: DjsClient;\n  public readonly node: NodeMan;\n  public readonly play: PlayMan;\n  public readonly queue: QMan;\n  public readonly src: SrcMan;\n  public readonly events: EvtMan;\n  public readonly options: LavxOptions;\n\n  constructor(discord: DjsClient, options: LavxOptions) {\n    this.discord = discord;\n    this.options = {\n      defaultSearchPlatform: 'ytsearch',\n      ...options,\n    };\n\n    this.events = new EvtMan(this);\n    this.node = new NodeMan(this);\n    this.play = new PlayMan(this);\n    this.queue = new QMan(this);\n    this.src = new SrcMan(this);\n\n    this.init();\n  }\n\n  private init() {\n    this.discord.on('raw', (packet) => {\n      if (packet.t === 'VOICE_SERVER_UPDATE' || packet.t === 'VOICE_STATE_UPDATE') {\n        this.play.handleVoiceUpdate(packet.d);\n      }\n    });\n\n    for (const nodeOptions of this.options.nodes) {\n      this.node.add(nodeOptions);\n    }\n\n    this.events.on('nodeDisconnect', (node) => {\n      this.node.migrate(node);\n    });\n  }\n\n  public sendGatewayPayload(guildId: string, payload: any) {\n    if (this.options.send) {\n      this.options.send(guildId, payload);\n    } else {\n      const guild = this.discord.guilds.cache.get(guildId);\n      if (guild) {\n        guild.shard.send(payload);\n      }\n    }\n  }\n\n  public async playInput(guildId: string, input: string, requester?: any) {\n    const resolved = await this.src.resolve(input);\n    if (!resolved || !resolved.tracks.length) return null;\n\n    const player = this.play.get(guildId) || this.play.create({ guildId });\n    const queue = this.queue.get(guildId);\n\n    if (resolved.type === 'playlist') {\n      for (const track of resolved.tracks) {\n        queue.add({ ...track, requester });\n      }\n    } else {\n      queue.add({ ...resolved.tracks[0], requester });\n    }\n\n    if (!player.playing && !player.paused && queue.current) {\n      await player.play();\n    }\n\n    return resolved;\n  }\n}\n","export const PlatformMap: Record<string, string> = {\n  spotify: 'spsearch',\n  apple: 'amsearch',\n  deezer: 'dzsearch',\n  yandex: 'ymsearch',\n  youtube: 'ytsearch',\n  'youtube music': 'ytmsearch',\n  soundcloud: 'scsearch',\n};\n"],"mappings":"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","names":["LoopMode"]}